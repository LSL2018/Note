# 概念

​	Kubernetes将容器放置在Pod中，Pod运行在Nodes上。

​	Node可以是虚拟机，或者物理机；节点都由控制平面管理，并包含运行Pod所需的服务。

 

# Components

## Kube

- 在集群中的每个节点上运行的代理，确保容器运行在一个Pod；
- 采用一组通过各种机制提供的PodSpecs，并确保这些PodSpecs中描述的容器运行良好；
- kubelet不管理非Kubernetes创建的容器。

## Kube-proxy

- 运行在集群的每个节点的网络代理，是K8S服务概念的一部分；
- 维护节点上的网络规则，这些网络规则允许从集群内外的网络会话到Pods进行网络通信；
- 使用操作系统包过滤层(如果有且可用)，否则将自己转发流量。

## Container runtime（[Container runtime](#Container runtimes)）

- 负责运行容器；
- Kubernetes支持几种container runtime：Docker, containerd,     CRI-O，以及Kubernetes     CRI(container runtime接口)的任何实现。

# Management

1）将node添加到API服务器有两种方法：

- node上的kubelet自注册到控制平台
- 用户手动添加node对象

控制平面会检查新的node对象是否有效：Kubernetes在内部创建一个node对象，并检查kubelet是否已经在一个与node的metadata name字段匹配的API服务器上注册。

2）如果node处于健康状态（所有必需的服务都在运行），就有资格运行Pod；Kubernetes为无效node保留对象，会继续检查是否健康，除非显式删除node对象；

3）node的名字是独一无二的：两个node不能同时具有相同的名字；具有相同名字的资源是相同的对象；使用相同名字的实例具有相同的状态；如果修改了一个实例而没有更改它的名称，这可能会导致不一致；如果需要替换或重大更新Node，则需要先从API服务器删除现有的Node对象，并在更新后重新添加；

4）当kubelet的 --register-node 标志为true（默认）时，会尝试自注册到API服务器

5）手动创建node对象时，设置kubelet的 --register-node=false，然后使用kubectl创建和修改对象；无论 --register-node 设置为什么值，都可以修改node对象属性；

6）可以结合节点标签和Pods上的节点选择器来控制调度；将node标记为不可调度可以阻止调度器将新pods放置到该节点，但不会影响该node上现有的pods

 

 

# **Node status**

1）node状态会包含以下信息

- Addresses
- Conditions
- Capacity and Allocatable
- Info

可以使用kubectl查看node的状态和其他详细信息：

![img](data:image/png;base64,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)

 

 

# Heartbeats

1）node发送的心跳（heartbeats）可以帮助集群确定每个节点的可用性；

2）有两种形式的心跳：

- 更新节点的 .status
- kube-node-lease命名空间的租约对象（lease objects），每个node都有一个关联的lease对象

与.status更新相比，lease是一种轻量级资源；Kubelet负责创建和更新node的.status，更新相关的lease



# Container runtimes



 