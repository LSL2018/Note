# Kubeadm部署单节点

## 1）安装kubeadm

​	[kubeadm安装教程](#Kubeadm安装)

注意：如果已安装kubeadm，执行以下命令更新版本：

```shell
apt-get update && apt-get upgrade
```

## 2）初始化控制平面节点

```shell
# （可选）计划将单节点升级为高可用集群，需要指定：
	--control-plane-endpoint
# （可选）kubeadm使用与默认网关相关联的网络接口来为这个特定的控制平面节点的API服务器设置发布地址。要使用不同的网络接口，或者IPV6寻址方式部署，需要指定 ：
	--apiserver-advertise-address=<ip-address>
# （可选）安装runtime
# （可选）验证和gcr.io容器镜像注册表的连接
    kubeadm config images pull

# 第一步：在kubeadm-config.yaml里添加如下内容（没有就创建）
    apiVersion: kubeadm.k8s.io/v1beta3
    imageRepository: registry.aliyuncs.com/google_containers
    kind: ClusterConfiguration
    kubernetesVersion: v1.22.2
    pod-network-cidr: 10.244.0.0/16
# 第二步：执行以下命令初始化：
	kubeadm init --config=kubeadm-config.yaml
# 第三步：让kubectl为非root用户工作
	mkdir -p $HOME/.kube
	sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
	sudo chown $(id -u):$(id -g) $HOME/.kube/config
# 第四步：让kubectl为root用户工作
	export KUBECONFIG=/etc/kubernetes/admin.conf
```

注意：==在再次运行kubeadm init之前，必须拆除集群（[清理](#清理)）==

## 3）安装Pod network add-on

​	通过部署基于Pod network add-on的容器网络接口(Container Network Interface，CNI)，可以让Pod相互通信。

​	群集DNS(CoreDNS)在网络安装之前不会启动。

​	每个集群只能安装一个Pod网络，安装步骤如下：

```shell
# 第一步：在控制平面节点或具有kubeconfig凭据的节点上：
	kubectl apply -f <podnetwork.yaml>
例如：kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml

# 第二步：验证
    kubectl get pods -n kube-system
```



## 4）控制平面节点隔离

​    默认情况下，出于安全原因，集群不会在控制平面节点上调度pod。在单节点中，希望能够在控制平面节点上调度Pods:

```shell
kubectl taint nodes --all node-role.kubernetes.io/master-
```

输出类似如下：

![node  taint  taint  "test-el" untainted  "node-role. kubernetes . io/master : "  "node-role. kubernetes . io/master : "  not found  not found ](data:image/png;base64,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)

## 5）添加工作节点

对每个需要添加到集群的节点，在该节点执行以下命令：

- ssh

- root用户

- 安装runtime（可选）

- 执行kubeadm init输出的命令，例如：

  ```shell
  kubeadm join --token <token> <control-plane-host>:<control-plane-port> --discovery-token-ca-cert-hash sha256:<hash>
  
  ## token可以通过以下命令获取：
  	kubeadm token list
  ## token创建（24小时有效期）：
  	kubeadm token create
  ## --discovery-token-ca-cert-hash通过以下命令获取：
  	openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | \
      openssl dgst -sha256 -hex | sed 's/^.* //'
  ```

  

## （可选）从控制平面节点以外的机器控制集群

​	为了让其他计算机上的kubectl与集群通信，执行以下命令：

```shell
scp root@<control-plane-host>:/etc/kubernetes/admin.conf .
kubectl --kubeconfig ./admin.conf get nodes
```



## （可选）代理API服务器到本地主机

- 从集群外部连接到API服务器：  

  ```shell
  scp root@<control-plane-host>:/etc/kubernetes/admin.conf .
  kubectl --kubeconfig ./admin.conf proxy
  ```

- 本地访问API服务器：

  http://localhost:8001/api/v1

## 清理

```shell
# 使用适当的凭据与控制平面节点通信：
kubectl drain <node name> --delete-emptydir-data --force --ignore-daemonsets

# 重置kubeadm安装状态：
kubeadm reset
注：reset过程不清楚或重置iptables规则或IPVS表

# 删除节点
kubectl delete node <node name>
```

