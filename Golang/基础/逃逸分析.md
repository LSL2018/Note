# 什么是堆/栈

- 堆（Heap）：一般来讲是人为手动进行管理，手动申请、分配、释放。一般所涉及的内存大小并不定，一般会存放较大的对象。另外其分配相对慢，涉及到的指令动作也相对多
- 栈（Stack）：由编译器进行管理，自动申请、分配、释放。一般不会太大，我们常见的函数参数（不同平台允许存放的数量不同），局部变量等等都会存放在栈上



# 什么是逃逸分析

在编译程序优化理论中，逃逸分析是一种确定指针动态范围的方法，简单来说就是分析在程序的哪些地方可以访问到该指针，通俗地讲，逃逸分析就是确定一个变量要放堆上还是栈上，规则如下：

- 是否有在其他地方（非局部）被引用。只要**有可能**被引用了，那么它**一定**分配到堆上。否则分配到栈上
- 即使没有被外部引用，但对象过大，无法存放在栈区上。依然有可能分配到堆上

对此可以理解为，逃逸分析是编译器用于决定变量分配到堆上还是栈上的一种行为。

Go 语言是在编译阶段确立逃逸，注意并不是在运行时。



# 查看逃逸分析过程

```shell
#xxx.go是go程序
go build -gcflags '-m -l' xxx.go
```



